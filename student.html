<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Student Dashboard</h1>
            <div class="user-info">
                <span id="userMobile"></span>
                <button id="logoutBtn">Logout</button>
            </div>
        </header>
        
        <main>
            <section class="upload-section">
                <h2>Upload Test Copy</h2>
                <div class="upload-area">
                    <input type="file" id="fileInput" accept="image/*,.pdf" hidden>
                    <label for="fileInput" class="upload-btn">Choose File</label>
                    <span id="fileName">No file selected</span>
                </div>
                <button id="uploadBtn" class="primary-btn">Upload</button>
            </section>
            
            <section class="feedback-section">
                <h2>Teacher's Feedback</h2>
                <div id="feedbackContainer">
                    <p class="placeholder">No feedback available yet</p>
                </div>
            </section>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
        // Check if user is logged in
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser || currentUser.type !== 'student') {
            window.location.href = 'index.html';
        }
        
        // Display user mobile
        document.getElementById('userMobile').textContent = `Mobile: ${currentUser.mobile}`;
        
        // File selection
        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                fileName.textContent = e.target.files[0].name;
            } else {
                fileName.textContent = 'No file selected';
            }
        });
        
        // Upload file
        document.getElementById('uploadBtn').addEventListener('click', () => {
            if (fileInput.files.length === 0) {
                alert('Please select a file first');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // Save to localStorage
                const studentCopies = JSON.parse(localStorage.getItem('studentCopies')) || {};
                studentCopies[currentUser.mobile] = {
                    fileName: file.name,
                    data: e.target.result,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('studentCopies', JSON.stringify(studentCopies));
                
                alert('File uploaded successfully!');
                fileName.textContent = 'No file selected';
                fileInput.value = '';
            };
            
            reader.readAsDataURL(file);
        });
        
        // Load feedback
        function loadFeedback() {
            const feedbacks = JSON.parse(localStorage.getItem('teacherFeedbacks')) || {};
            const feedback = feedbacks[currentUser.mobile];
            
            const container = document.getElementById('feedbackContainer');
            container.innerHTML = '';
            
            if (feedback) {
                const feedbackEl = document.createElement('div');
                feedbackEl.className = 'feedback-item';
                
                if (feedback.data.startsWith('data:image')) {
                    const img = document.createElement('img');
                    img.src = feedback.data;
                    feedbackEl.appendChild(img);
                } else {
                    const link = document.createElement('a');
                    link.href = feedback.data;
                    link.download = feedback.fileName;
                    link.textContent = `Download: ${feedback.fileName}`;
                    feedbackEl.appendChild(link);
                }
                
                const date = document.createElement('p');
                date.textContent = `Received: ${new Date(feedback.timestamp).toLocaleString()}`;
                feedbackEl.appendChild(date);
                
                container.appendChild(feedbackEl);
            } else {
                container.innerHTML = '<p class="placeholder">No feedback available yet</p>';
            }
        }
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        });
        
        // Initial load
        loadFeedback();
        
        // Check for new feedback every 5 seconds
        setInterval(loadFeedback, 5000);
    </script>
</body>
</html>