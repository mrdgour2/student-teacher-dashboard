<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Teacher Dashboard</h1>
            <div class="user-info">
                <span>Teacher: teacher</span>
                <button id="logoutBtn">Logout</button>
            </div>
        </header>
        
        <main>
            <section class="student-selection">
                <h2>Select Student</h2>
                <div class="input-group">
                    <label for="studentMobile">Student Mobile Number</label>
                    <input type="tel" id="studentMobile" placeholder="Enter student mobile number">
                    <button id="selectBtn" class="primary-btn">Select</button>
                </div>
            </section>
            
            <section class="student-copy">
                <h2>Student's Test Copy</h2>
                <div id="copyContainer">
                    <p class="placeholder">Select a student to view their test copy</p>
                </div>
            </section>
            
            <section class="feedback-upload">
                <h2>Upload Feedback</h2>
                <div class="upload-area">
                    <input type="file" id="feedbackFile" accept="image/*,.pdf" hidden>
                    <label for="feedbackFile" class="upload-btn">Choose File</label>
                    <span id="feedbackFileName">No file selected</span>
                </div>
                <button id="uploadFeedbackBtn" class="primary-btn" disabled>Upload Feedback</button>
            </section>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
        // Check if user is logged in
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser || currentUser.type !== 'teacher') {
            window.location.href = 'index.html';
        }
        
        let selectedStudent = null;
        
        // Select student
        document.getElementById('selectBtn').addEventListener('click', () => {
            const mobile = document.getElementById('studentMobile').value;
            if (!mobile) {
                alert('Please enter a mobile number');
                return;
            }
            
            selectedStudent = mobile;
            loadStudentCopy();
            
            // Enable feedback upload
            document.getElementById('uploadFeedbackBtn').disabled = false;
        });
        
        // Load student's copy
        function loadStudentCopy() {
            const studentCopies = JSON.parse(localStorage.getItem('studentCopies')) || {};
            const copy = studentCopies[selectedStudent];
            
            const container = document.getElementById('copyContainer');
            container.innerHTML = '';
            
            if (copy) {
                const copyEl = document.createElement('div');
                copyEl.className = 'copy-item';
                
                if (copy.data.startsWith('data:image')) {
                    const img = document.createElement('img');
                    img.src = copy.data;
                    copyEl.appendChild(img);
                } else {
                    const link = document.createElement('a');
                    link.href = copy.data;
                    link.download = copy.fileName;
                    link.textContent = `Download: ${copy.fileName}`;
                    copyEl.appendChild(link);
                }
                
                const info = document.createElement('div');
                info.className = 'copy-info';
                info.innerHTML = `
                    <p><strong>Student:</strong> ${selectedStudent}</p>
                    <p><strong>File:</strong> ${copy.fileName}</p>
                    <p><strong>Uploaded:</strong> ${new Date(copy.timestamp).toLocaleString()}</p>
                `;
                copyEl.appendChild(info);
                
                container.appendChild(copyEl);
            } else {
                container.innerHTML = '<p class="placeholder">No test copy found for this student</p>';
            }
        }
        
        // Feedback file selection
        const feedbackFile = document.getElementById('feedbackFile');
        const feedbackFileName = document.getElementById('feedbackFileName');
        
        feedbackFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                feedbackFileName.textContent = e.target.files[0].name;
            } else {
                feedbackFileName.textContent = 'No file selected';
            }
        });
        
        // Upload feedback
        document.getElementById('uploadFeedbackBtn').addEventListener('click', () => {
            if (!selectedStudent) {
                alert('Please select a student first');
                return;
            }
            
            if (feedbackFile.files.length === 0) {
                alert('Please select a feedback file');
                return;
            }
            
            const file = feedbackFile.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // Save to localStorage
                const feedbacks = JSON.parse(localStorage.getItem('teacherFeedbacks')) || {};
                feedbacks[selectedStudent] = {
                    fileName: file.name,
                    data: e.target.result,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('teacherFeedbacks', JSON.stringify(feedbacks));
                
                alert('Feedback uploaded successfully!');
                feedbackFileName.textContent = 'No file selected';
                feedbackFile.value = '';
            };
            
            reader.readAsDataURL(file);
        });
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        });
    </script>
</body>
</html>